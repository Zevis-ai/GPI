<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הזמנות שלי</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .profile-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile-info img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 20px;
        }
        .profile-info h2 {
            margin: 0;
            color: #555;
        }
        .orders-container {
            margin-top: 20px;
        }
        .order {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 15px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        .order-id {
            font-weight: bold;
            color: #333;
        }
        .order-date {
            color: #888;
        }
        .order-status {
            font-weight: bold;
            padding: 5px;
            border-radius: 4px;
        }
        .status-pending {
            background: #f0ad4e;
            color: #fff;
        }
        .status-completed {
            background: #5bc0de;
            color: #fff;
        }
        .status-cancelled {
            background: #d9534f;
            color: #fff;
        }
        .order-details {
            margin-top: 10px;
        }
        .no-orders {
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>הזמנות שלי</h1>
        <div class="profile-info">
            <img id="profile-picture" src="default-profile.png" alt="Profile Picture">
            <div>
                <h2 id="user-greeting">שלום, משתמש</h2>
                <p id="user-email"></p>
            </div>
        </div>
        <div id="orders-container" class="orders-container">
            <p id="loading">טוען הזמנות...</p>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAaOp49avUlLknLkGzskeCPCk9xPOAeMUE",
            authDomain: "gpi0-d1e6d.firebaseapp.com",
            databaseURL: "https://gpi0-d1e6d-default-rtdb.firebaseio.com",
            projectId: "gpi0-d1e6d",
            storageBucket: "gpi0-d1e6d.appspot.com",
            messagingSenderId: "138797690477",
            appId: "1:138797690477:web:5d04dd40ed2a577dbed964",
            measurementId: "G-DP0JJ2FX3D"
        };

        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const database = firebase.database();

        auth.onAuthStateChanged(user => {
            if (user) {
                const profilePicture = document.getElementById('profile-picture');
                const userGreeting = document.getElementById('user-greeting');
                const userEmail = document.getElementById('user-email');

                profilePicture.src = user.photoURL || 'default-profile.png';
                userGreeting.textContent = `שלום, ${user.displayName || 'משתמש'}`;
                userEmail.textContent = user.email;

                loadUserOrders(user.email);
            } else {
                window.location.href = "https://zevis-ai.github.io/GPI/login.html";
            }
        });

        function loadUserOrders(userEmail) {
            const ordersRef = database.ref('orders');
            ordersRef.orderByChild('contactEmail').equalTo(userEmail).on('value', (snapshot) => {
                const ordersContainer = document.getElementById('orders-container');
                const loadingElement = document.getElementById('loading');
                
                loadingElement.style.display = 'none';
                ordersContainer.innerHTML = '';

                const orders = [];
                snapshot.forEach((childSnapshot) => {
                    orders.push({ key: childSnapshot.key, ...childSnapshot.val() });
                });

                if (orders.length === 0) {
                    ordersContainer.innerHTML = '<p class="no-orders">אין הזמנות להצגה כרגע.</p>';
                } else {
                    orders.forEach((order, index) => {
                        const orderElement = createOrderElement(order, order.key);
                        ordersContainer.appendChild(orderElement);
                        
                        anime({
                            targets: orderElement,
                            translateY: [50, 0],
                            opacity: [0, 1],
                            easing: 'easeOutExpo',
                            duration: 1000,
                            delay: index * 100
                        });
                    });
                }
            });
        }

        function createOrderElement(order, orderId) {
            const orderDiv = document.createElement('div');
            orderDiv.className = 'order';
            orderDiv.innerHTML = `
                <span class="order-id">הזמנה מספר: ${orderId}</span>
                <span class="order-date">תאריך: ${new Date(order.date).toLocaleDateString('he-IL')}</span>
                <span class="order-status ${getStatusClass(order.status)}">${getStatusText(order.status)}</span>
                <p class="order-details">
                    <strong>שם המוצר:</strong> ${order.productName}<br>
                    <strong>קטגוריה:</strong> ${order.productCategory}<br>
                    <strong>תיאור:</strong> ${order.productDescription}<br>
                    <strong>חומרים:</strong> ${order.productMaterials}<br>
                    <strong>כמות:</strong> ${order.productQuantity}<br>
                    <strong>מחיר משוער:</strong> ${order.estimatedPrice}<br>
                    <strong>תאריך משלוח:</strong> ${new Date(order.deliveryDate).toLocaleDateString('he-IL')}<br>
                    <strong>דרישות נוספות:</strong> ${order.additionalRequirements}<br>
                    <strong>שם איש קשר:</strong> ${order.contactName}<br>
                    <strong>אימייל איש קשר:</strong> ${order.contactEmail}<br>
                    <strong>טלפון איש קשר:</strong> ${order.contactPhone}<br>
                </p>
                <button class="edit-order-button" data-order-id="${orderId}">ערוך הזמנה</button>
            `;
            return orderDiv;
        }

        function getStatusClass(status) {
            switch (status) {
                case 'pending': return 'status-pending';
                case 'completed': return 'status-completed';
                case 'cancelled': return 'status-cancelled';
                default: return '';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'ממתין';
                case 'completed': return 'הושלם';
                case 'cancelled': return 'בוטל';
                default: return status;
            }
        }
    </script>
</body>
</html>
